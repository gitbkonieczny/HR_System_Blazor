#pragma checksum "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\Components\UserProfile.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "29c2c2d37b1c4909fdc51171317e690b02094eb1"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace HUDEwiBlazor.Components
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Data.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Classes;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Interfaces;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.ProtectedBrowserStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Calendars;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Resources;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Navigations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Grids;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.DropDowns;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Inputs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Popups;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.QueryBuilder;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using AutoMapper;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Classes.Mapped;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Buttons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Syncfusion.Blazor.Notifications;

#line default
#line hidden
#nullable disable
#nullable restore
#line 32 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using HUDEwiBlazor.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using System.Collections.ObjectModel;

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Rendering;

#line default
#line hidden
#nullable disable
#nullable restore
#line 35 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
    public partial class UserProfile : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 171 "C:\Users\BKC\source\repos\ewiblazorserver\HUDEwiBlazor\Components\UserProfile.razor"
       
    private Employee Employee = new Employee();
    private string validation_message = "";
    protected List<Gender> _genders;
    protected SfToast ToastObj;
    Type roles_models = typeof(MappedRoles);
    protected List<MappedRoles> _roles;
    private SfMultiSelect<int[]> RolesSelect;

    private int HolidaysMax = 0;
    private int ConfirmedHolidayForNow = 0;

    protected override async Task OnInitializedAsync()
    {
        _genders = iSecurity.GetAllGenders();
        _roles = _mapper.Map<List<MappedRoles>>(await iSecurity.GetRolesAsync());

        var guid = await ProtectedSessionStorage.GetAsync<string>("GUID");
        Employee = await iSecurity.GetEmployee(guid);


        var holidayset = await iHoliday.GetHolidaySet((int)Employee.EmployeeID, DateTime.Now);
        if (holidayset != null) HolidaysMax = (int) holidayset.HolidaysMax;
        ConfirmedHolidayForNow = await iHoliday.ConfirmedHolidayForNow(Employee, DateTime.Now.Year);

    }

    private async Task OnChange(UploadChangeEventArgs args)
    {
        foreach (var file in args.Files)
        {

            MemoryStream resized_ms = new MemoryStream();
            resized_ms = await imageProcessing.Resize(file.Stream.ToArray(), 135, 240);
            Employee.Avatar = await iSecurity.SaveAvatar((int)Employee.EmployeeID, resized_ms.ToArray());

        }
    }

    public async Task ValidFormSubmitted(EditContext editContext)
    {
        Name_validation = null;
        Surname_validation = null;
        var response = await iSecurity.UpdateEmployee(Employee);
        if (response.Item1 != "OK")
        {
            ToastObj.Title = Localizer.GetText(response.Item1) + " " + response.Item2;
            ToastObj.Show();
            return;
        }
        else
        {

            ToastObj.Title = Localizer.GetText("OperationSuccess");
            ToastObj.Show();
        }
    }
    public void InvalidFormSubmitted(EditContext editContext)
    {
        Employee model = (Employee)editContext.Model;
        if (model.Name == "" || model.Name == null)
        {
            Name_validation = Localizer.GetText("Required");
        }
        if (model.Surname == "" || model.Surname == null)
        {
            Surname_validation = Localizer.GetText("Required");
        }
        if (model.Name.Length<3)
        {
            Name_validation = Localizer.GetText("MinThree");
        }
        if(model.Surname.Length<3)
        {
            Surname_validation = Localizer.GetText("MinThree");
        }
    }

    public void Created()
    {
        if (RolesSelect != null) RolesSelect.Refresh();
        // if (MenuSelect != null) MenuSelect.Refresh();

    }

    public string authorization_result = null;
    public PasswordChangeModel passwordChangeModel = new PasswordChangeModel();
    public string password_validation_1 { get; set; }
    public string password_validation_2 { get; set; }
    public string Name_validation { get; set; }
    public string Surname_validation { get; set; }


    public async Task ChangePasswordValidFormSubmitted(EditContext editContext)
    {
        password_validation_1 = null;
        password_validation_2 = null;
        PasswordChangeModel model = (PasswordChangeModel)editContext.Model;
        if (model.password1 == "" || model.password1 == null)
            password_validation_1 = Localizer.GetText("Required");
        if (model.password2 == "" || model.password2 == null)
            password_validation_2 = Localizer.GetText("Required");

        if (password_validation_1 != null || password_validation_2 != null)
        {
            return;
        }
        if (passwordChangeModel.password1 == passwordChangeModel.password2)
        {
            var result = await iSecurity.ChangePasswordforGuid(passwordChangeModel.password1, Employee.GUID);
            if (result)
            {
                authorization_result = null;
                ToastObj.Title = Localizer.GetText("OperationSuccess");
                ToastObj.Show();
            }
        }
        else
        {
            authorization_result = Localizer.GetText("DiffrentPassword");

        }

    }

    public void ChangePasswordInvalidFormSubmitted(EditContext editContext)
    {
        authorization_result = null;
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IMapper _mapper { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IImageProcessing imageProcessing { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IHolidayApiService iHoliday { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ISecurity iSecurity { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ProtectedSessionStorage ProtectedSessionStorage { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ISyncfusionStringLocalizer Localizer { get; set; }
    }
}
#pragma warning restore 1591
